> Данный файл является черновиком, т.к. проект находится в процессе разработки. 
> Он будет корректироваться и дополняться по мере развития проекта.

# Task Management System

Система управления задачами с микросервисной архитектурой, включающая веб‑интерфейс, десктоп‑клиент и асинхронную обработку данных.

## Обзор

Проект представляет собой полнофункциональную систему управления задачами, реализованную с использованием современных технологий и подходов. Основные особенности:
* микросервисная архитектура;
* централизованный доступ через API Gateway (Ocelot);
* аутентификация на основе JWT‑токенов;
* асинхронная обработка задач через RabbitMQ;
* кэширование в Redis;
* хранение данных в PostgreSQL;
* развёртывание всех компонентов через Docker Compose.

## Архитектура

Система состоит из следующих ключевых компонентов:

1. **Основной API (ASP.NET Core с Minimal API)**  (в процессе)
   * CRUD‑операции с задачами;
   * аутентификация пользователей;
   * работа с проектами и подзадачами.

2. **База данных (PostgreSQL с EF Core)**  (в процессе)
   * таблицы для пользователей, проектов, задач;
   * реляционные связи между сущностями;
   * управление схемой через миграции.

3. **Автомаппинг (AutoMapper)**  (в процессе)
   * преобразование DTO в сущности и обратно;
   * сокращение объёма шаблонного кода.

4. **RabbitMQ**  (в процессе)
   * отправка уведомлений;
   * ~~обработка отложенных задач;~~
   * ~~синхронизация данных.~~

5. **Redis**  (в процессе)
   * ~~кэширование часто используемых данных;~~
   * хранилище сессий;
   * ~~счётчики и статистика.~~

6. **WPF‑клиент**  (разработка в планах)
   * графический интерфейс для работы с задачами;
   * ~~оффлайн‑режим с последующей синхронизацией;~~
   * ~~система уведомлений.~~

## Технологии

* **Backend**: ASP.NET Core (Minimal API).
* **База данных**: PostgreSQL.
* **ORM**: Entity Framework Core.
* **Автомаппинг**: AutoMapper.
* **Очереди сообщений**: RabbitMQ.
* **Кэширование**: Redis.
* **Аутентификация**: JWT.
* **API Gateway**: Ocelot.
* **Клиентское приложение**: WPF (.NET).
* **Оркестрация**: Docker Compose.

## Функциональные возможности

* Создание, редактирование, удаление и просмотр задач.
* Работа с проектами и иерархией подзадач.
* Аутентификация и авторизация пользователей.
* Отображение только собственных данных пользователя.
* ~~Асинхронная обработка фоновых задач.~~
* ~~Кэширование данных для повышения производительности.~~
* ~~Уведомления о событиях системы.~~
* ~~Оффлайн‑режим в десктопном клиенте с синхронизацией при подключении.~~

## API‑эндпоинты

Основной API предоставляет следующие HTTP‑методы для работы с задачами и аутентификации.

### Миграция

> *Примечание!* Все миграции возвращают объект со следующими полями:
> - Message: результат миграции
> - PendingMigrations: список ожидающих миграций
> - AppliedMigrations: список всех примененных когда-либо миграций

* **`GET /api/auth/migrate`**
  Запуск миграции БД для Сервиса Сервис аутентификации
  **Доступ**: если БД не создана, то любой пользователь, иначе Role=admin
  **Параметры**: отсутствуют.  
  **Ответ**: см. Примечание.

* **`GET /api/notify/migrate`**
  Запуск миграции БД для Сервис рассылки сообщений
  **Доступ**: Role=admin
  **Параметры**: отсутствуют.  
  **Ответ**: см. Примечание.

* **`GET /api/tasks/migrate`**
  Запуск миграции БД для Сервис для работы с задачами
  **Доступ**: Role=admin
  **Параметры**: отсутствуют.  
  **Ответ**: см. Примечание.


  ### Аутентификация

* **`POST /api/auth/register`**  
  Регистрация пользователя.
  **Доступ**: Role=admin
  **Тело запроса**:  
    ```json
    {
      "username": "string",
      "email": "string",
      "password": "string",
      "role": "inteter"
    }
    ```  
  **Ответ**: 201 Created при успешной регистрации или 400, если пользователь уже существует


* **`POST /api/auth/login`**  
  Аутентификация пользователя и получение JWT‑токена.
  **Тело запроса**:  
    ```json
    {
      "username": "string",
      "password": "string"
    }
    ```  
  **Ответ**:  
    ```json
    {
      "token": "JWT-token-string",
      "expiresIn": "seconds"
    }
    ```

* **`GET /api/auth/refresh`**  
  Запрос на обновление JWT‑токена.
  **Доступ**: аутентификация
  **Тело запроса**:  
    ```json
    {
      "refresh-token": "string"
    }
    ```  
  **Ответ**:  
    ```json
    {
      "access_token": "JWT-token-string",
      "refresh_token": "JWT-token-string"
    }
    ```


### Проекты

* **`GET /api/projects`**  
  Получение списка всех проектов.  
  **Доступ**: аутентификация
  **Параметры**: отсутствуют.  
  **Ответ**: массив объектов проектов.

* **`POST /api/projects`**  
  Создание нового проекта.  
  **Доступ**: Role=admin
  **Тело запроса**: объект проекта (JSON).  
  **Ответ**: созданный объект проекта с присвоенным ID.

* **`GET /api/projects/{id}`**  
  Получение проекта по идентификатору.  
  **Доступ**: аутентификация
  **Параметры**:  
    * `id` — уникальный идентификатор проекта (целое число).  
  **Ответ**: объект проекта или 404, если проект не найдена.

* **`PUT /api/tasks/{id}`**  
  Обновление проекта по идентификатору.  
  **Доступ**: аутентификация
  **Параметры**:  
    * `id` — уникальный идентификатор проекат (целое число).  
  **Тело запроса**: частично или полностью обновлённый объект проекта (JSON).  
  **Ответ**: обновлённый объект проекта.

* **`DELETE /api/tasks/{id}`**  
  Удаление проекта по идентификатору.  
  **Доступ**: Role=admin
  **Параметры**:  
    * `id` — уникальный идентификатор проекта (целое число).  
  **Ответ**: 204 No Content при успешном удалении или 404, если проект не найдена.

### Задачи

* **`GET /api/tasks`**  
  Получение списка задач текущего пользователя.  
  **Доступ**: аутентификация
  **Параметры**: отсутствуют.  
  **Ответ**: массив объектов задач.

* **`POST /api/tasks`**  
  Создание новой задачи.  
  **Доступ**: аутентификация
  **Тело запроса**: объект задачи (JSON).  
  **Ответ**: созданный объект задачи с присвоенным ID.

* **`GET /api/tasks/{id}`**  
  Получение задачи по идентификатору.  
  **Доступ**: аутентификация
  **Параметры**:  
    * `id` — уникальный идентификатор задачи (целое число).  
  **Ответ**: объект задачи или 404, если задача не найдена.

* **`PUT /api/tasks/{id}`**  
  Обновление задачи по идентификатору.  
  **Доступ**: аутентификация
  **Параметры**:  
    * `id` — уникальный идентификатор задачи (целое число).  
  **Тело запроса**: частично или полностью обновлённый объект задачи (JSON).  
  **Ответ**: обновлённый объект задачи.

* **`DELETE /api/tasks/{id}`**  
  Удаление задачи по идентификатору.
  **Доступ**: аутентификация
  **Параметры**:  
    * `id` — уникальный идентификатор задачи (целое число).  
  **Ответ**: 204 No Content при успешном удалении или 404, если задача не найдена.


  ### Комментарии

* **`POST /api/tasks/{{task_id}}/comments`**  
  Создание нового комментария, прикрепленного к указанной задаче.
  **Доступ**: аутентификация
  **Параметры**:  
    * `task_id` — уникальный идентификатор задачи (целое число).  
  **Тело запроса**: объект комментария (JSON).  
  **Ответ**: созданный объект задачи с присвоенным ID.

* **`GET /api/comments/{id}`**  
  Получение задачи по идентификатору.
  **Доступ**: аутентификация
  **Параметры**:  
    * `id` — уникальный идентификатор задачи (целое число).  
  **Ответ**: объект задачи или 404, если задача не найдена.

* **`GET /api/tasks/{{task_id}}/comments`**  
  Получение всех комментариев, прикрепленных к указанной задаче.
  **Доступ**: аутентификация
  **Параметры**:  
    * `task_id` — уникальный идентификатор задачи (целое число).  
  **Ответ**: массив объектов комментариев.  


  ### Вложения

* **`POST /api/tasks/{{task_id}}/tasks/{{task_id}}/attachments?fileName=example.txt`**  
  Добавление файла как вложения к указанной задаче.
  **Доступ**: аутентификация
  **Параметры**:  
    * `task_id` — уникальный идентификатор задачи (целое число).  
    * `fileName` — имя загружаемого файла (строка). 
  Тело запроса: файл в формате multipart/form‑data с указанием:
    `name="file"` — ключевое имя поля для файла;
    `filename="example.txt"` — оригинальное имя файла;
    `Content-Type` — тип содержимого файла (например, text/plain).
Ответ: 201 Created в случае успешного добавления вложения или 500 Internal Server Error в случае ошибки.

* **`GET /api/attachments/{id}`**  
  Получение вложения по идентификатору.  
  **Доступ**: аутентификация
  **Параметры**:  
    * `id` — уникальный идентификатор вложения (целое число).  
  **Ответ**: объект вложения или 404, если вложение не найдено.

* **`GET /api/tasks/{{task_id}}/attachments`**  
  **Доступ**: аутентификация
  Получение всех вложений, прикрепленных к указанной задаче.  
  **Параметры**:  
    * `task_id` — уникальный идентификатор задачи (целое число).  
  **Ответ**: массив объектов вложений.  

* **`GET /api/files?name=example.txt&path=file_path`**  
  Получение файла (не объекта) вложения.  
  **Доступ**: аутентификация
  **Параметры**:  
    * `example.txt` — оригинальное имя файла.  
    * `path` — путь с именем к файлу (путь и имя файла хранятся в `AttachmentEntity`).  
  **Ответ**: запрашиваемый файл или 400, если не задан один из параметров, или 404, если файл не найден.  
  

## Развёртывание

Все компоненты системы развёртываются с помощью Docker Compose:

1. Соберите образы:  
    
    bash
    
    ```bash
    docker-compose build
    ```

2. Запустите сервисы:
    
    bash
    
    ```bash
    docker-compose up -d
    ```
    
3. Проверьте статус сервисов:
    
    bash
    
    ```bash
    docker-compose ps
    ```
    

## Структура проекта
```
├── src
│   └── TMS.ApiGateway                  # Точка входа в систему
│       ├── Controllers/                # Контроллеры web-интерфейса
│       ├── Extensions/                 # Расширения
│       |   └── Services/               # для IServiceCollection
│       ├── Views/                      # Представления (cshtml)
│       ├── appsettings.json            # Настройки
│       ├── Dockerfile                  # образ Docker
│       ├── ocelot.json                 # настройки для ocelot
│       └── Program.cs                  # Точка входа
│   └──  TMS.AuthService                # Сервис аутентификации
│       ├── Configurations/             # Файл для работы с конфигурациями
│       ├── Data/                       # Конфигурация БД и миграции
│       ├── Entities/                   # Entity-файлы для EF Core
│       ├── Extensions/                 # Расширения
│       |   └── ApiEndpoints/           # для MinimalAPI
│       |   └── Services/               # для IServiceCollection
│       ├── Models                      # Модели и dto-файлы
│       ├── HttpExamples/               # http-запросы для тестирования
│       ├── Services/                   # Сервисы
│       ├── APIAuthService.xml          # Сгенерированный файл для gRPC, созданный Visual Studio
│       ├── appsettings.json            # Настройки
│       ├── Dockerfile                  # образ Docker
│       └── Program.cs                  # Точка входа
│   └── TMS.Common                      # Сборка с общими классами
│       ├── Extensions/                 # Расширения для IServiceCollection
│       ├── Helpers/                    # Вспомогательный классы для работы со строками и миграции
│       ├── Models                      # Модели и dto-файлы
│       ├── RabbitMq                    # Consumers, сервис для инициализации очередей, TaskMessage
│       ├── Services/                   # Сервисы
│       └── AuthDataContextFactory.cs   # Вспомогательный файл для фиксации ошибки при запуске миграции
│   └── TMS.Contracts                   # Проект с proto-файлами
│       ├── Protos                      # Proto-файлы
│   └── TMS.FileStorageService          # Сервис хранения файлов
│       ├── Extensions/                 # Расширения
│       |   └── ApiEndpoints/           # для MinimalAPI
│       ├── HttpExamples/               # http-запросы для тестирования
│       ├── appsettings.json            # Настройки
│       ├── Dockerfile                  # образ Docker
│       └── Program.cs                  # Точка входа
│   └── TMS.NotificationService         # Сервис рассылки сообщений
│       ├── Data/                       # Конфигурация БД и миграции
│       ├── Entities/                   # Entity-файлы для EF Core
        ├── Extensions/                 # Расширения
│       |   └── ApiEndpoints/           # для MinimalAPI
│       |   └── Services/               # для IServiceCollection
│       ├── HttpExamples/               # http-запросы для тестирования
│       ├── appsettings.json            # Настройки
│       ├── Dockerfile                  # образ Docker
│       └── Program.cs                  # Точка входа
│   └── TMS.TaskService                 # Сервис для работы с задачами
│       ├── Data/                       # Конфигурация БД и миграции
│       ├── Entities/                   # Entity-файлы для EF Core
        ├── Extensions/                 # Расширения
│       |   └── ApiEndpoints/           # для MinimalAPI
│       |   └── Services/               # для IServiceCollection
│       ├── HttpExamples/               # http-запросы для тестирования
│       ├── MappingProfiles/            # Настройки для AutoMapper
│       ├── Models                      # Модели и dto-файлы
│       ├── APIAuthService.xml          # Сгенерированный файл для gRPC, созданный Visual Studio
│       ├── appsettings.json            # Настройки
│       ├── Dockerfile                  # образ Docker
│       └── Program.cs                  # Точка входа
├── docker-compose/                     # Конфигурационный файл, который описывает инфраструктуру проекта
├── docs/                               # Дополнительная документация
├── scripts/                            # Скрипты развертывания/миграции
├── tests/                              # Для юнит- и интеграционных тестов
│   └── TMS.ApiGateway.Tests            # Точка входа в систему
│       ├── Fixtures/                   # Вспомогательные классы для настройки тестов
│       |   ├── DatabaseFixture.cs      # Инициализация тестовой БД
│       |   └── WebAppFixture.cs        # Инициализация тестовой БД
│       ├── WebAppFixture.cs            # Запуск тестового хоста (TestServer)
│       ├── Integration/                # Интеграционные тесты (с внешними зависимостями
│       |   ├── ApiTests/               # 
│       |   └── DbTests/                # 
│       ├── HttpExamples/               # 
│       ├── Unit/                       # Юнит‑тесты (без внешних зависимостей)
│       └── Utilities/                  # Общие утилиты для тестов
│           └── TestDataGenerator.cs    # Генерация тестовых данных
│   └── TMS.AuthService.Tests           # Сервис аутентификации
│       ├── Fixtures/                   # Вспомогательные классы для настройки тестов
│       |   ├── DatabaseFixture.cs      # Инициализация тестовой БД
│       |   └── WebAppFixture.cs        # Инициализация тестовой БД
│       ├── WebAppFixture.cs            # Запуск тестового хоста (TestServer)
│       ├── Integration/                # Интеграционные тесты (с внешними зависимостями
│       |   ├── ApiTests/               # 
│       |   └── DbTests/                # 
│       ├── HttpExamples/               # 
│       ├── Unit/                       # Юнит‑тесты (без внешних зависимостей)
│       └── Utilities/                  # Общие утилиты для тестов
│           └── TestDataGenerator.cs    # Генерация тестовых данных
│   └── TMS.Common.Tests                # Сборка с общими классами
│       ├── Unit/                       # Юнит‑тесты (без внешних зависимостей)
│       └── Utilities/                  # Общие утилиты для тестов
│           └── TestDataGenerator.cs    # Генерация тестовых данных
│   └── TMS.FileStorageService.Tests    # Сервис хранения файлов
│       ├── Fixtures/                   # Вспомогательные классы для настройки тестов
│       |   ├── DatabaseFixture.cs      # Инициализация тестовой БД
│       |   └── WebAppFixture.cs        # Инициализация тестовой БД
│       ├── WebAppFixture.cs            # Запуск тестового хоста (TestServer)
│       ├── Integration/                # Интеграционные тесты (с внешними зависимостями
│       |   ├── ApiTests/               # 
│       |   └── DbTests/                # 
│       ├── HttpExamples/               # 
│       ├── Unit/                       # Юнит‑тесты (без внешних зависимостей)
│       └── Utilities/                  # Общие утилиты для тестов
│           └── TestDataGenerator.cs    # Генерация тестовых данных
│   └── TMS.NotificationService.Tests   # Сервис рассылки сообщений
│       ├── Fixtures/                   # Вспомогательные классы для настройки тестов
│       |   ├── DatabaseFixture.cs      # Инициализация тестовой БД
│       |   └── WebAppFixture.cs        # Инициализация тестовой БД
│       ├── WebAppFixture.cs            # Запуск тестового хоста (TestServer)
│       ├── Integration/                # Интеграционные тесты (с внешними зависимостями
│       |   ├── ApiTests/               # 
│       |   └── DbTests/                # 
│       ├── HttpExamples/               # 
│       ├── Unit/                       # Юнит‑тесты (без внешних зависимостей)
│       └── Utilities/                  # Общие утилиты для тестов
│           └── TestDataGenerator.cs    # Генерация тестовых данных
│   └── TMS.TaskService.Tests           # Сервис для работы с задачами
│       ├── Fixtures/                   # Вспомогательные классы для настройки тестов
│       |   ├── DatabaseFixture.cs      # Инициализация тестовой БД
│       |   └── WebAppFixture.cs        # Инициализация тестовой БД
│       ├── WebAppFixture.cs            # Запуск тестового хоста (TestServer)
│       ├── Integration/                # Интеграционные тесты (с внешними зависимостями
│       |   ├── ApiTests/               # 
│       |   └── DbTests/                # 
│       ├── HttpExamples/               # 
│       ├── Unit/                       # Юнит‑тесты (без внешних зависимостей)
│       └── Utilities/                  # Общие утилиты для тестов
│           └── TestDataGenerator.cs    # Генерация тестовых данных
├── .env                                # Файл с переменными для окружения
├── .env.example                        # Шаблон для файла с переменными для окружения
├── Directory.Packages.props            # Файл для определения версий пакетов NuGet
└── README.md                           # Документация
```


## Требования

- Docker и Docker Compose;
    
- .NET SDK (для разработки);
        

## Начало работы

1. Клонируйте репозиторий:
    
    bash
    
    ```bash
    git clone https://github.com/Alexander-Yurtaev/TaskManagementSystem.git
    ```
    
2. Перейдите в директорию проекта:
    
    bash
    
    ```bash
    cd TaskManagementSystem
    ```
    
3. Запустите инфраструктуру:
    
    bash
    
    ```bash
    docker-compose up -d
    ```
    
4. Откройте ~~веб‑интерфейс или~~ WPF‑клиент для работы с системой.

## Контакты

По всем вопросам обращайтесь:  
- email: ayurtaev@mail.ru
- telegram: @AlexanderYurtaev